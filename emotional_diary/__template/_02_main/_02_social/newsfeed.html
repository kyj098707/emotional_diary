{% extends "../../base.html" %}
{% load static %}

{% block st %}
.go-back:hover svg {
    fill: #bbb;
}

.newsfeed-slider__item {
    background-color: white;
    border-radius: 10px;
    height: 550px;
    flex-shrink: 0;
    margin: 20px;
    transition: all .3s;
    overflow: hidden;
    position: relative;
}

.diary-user {
    text-decoration: none;
    color: black;
}
.diary-user:hover {
    color: #444;
}

.diary-user__img {
    border-radius: 50%;
}

.diary-user__detail {
    cursor:pointer;
}

.diary-contents {
    height: 300px;
    position: relative;
}

.diary-contents__date_emoji {
    font-size: 15px;
}

.diary-contents__date, .diary-comment__date, {
    color: rgba(0,0,0,0.5);
}

.diary-contents__emoji {
    color: #fc829f;
    font-size: 15px;
}

.diary-contents__title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
}

.diary-contents__txt {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 11;
    overflow: hidden;
}

.diary-contents__tag {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
    overflow: hidden;
}

.diary-response {
    position: absolute;
    width: 100%;
    bottom: 0;
}

.diary-contents__more, .diary-comment__more {
    cursor: pointer;
    color: rgba(0, 0, 0, 0.5);
}
.diary-contents__more:hover, .diary-comment__more:hover {
    color: rgba(0, 0, 0, 1);
}

.liked {
    cursor : pointer;
}

.liked:hover {
    fill: red;
}


/* diary_modal.html */

.modal-content {
    animation: animations 0.3s linear;
}

@keyframes animations {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

.diary-modal-content {
    height: 600px;
}

.diary-modal-content__main {
    width: 70%;
}

.diary-contents_detail {
    height: 490px;
    overflow-y: auto;
}

.diary-contents__txt_detail {
    display: block;
}

.add-comment {
    position: absolute;
    width: 70%;
    bottom: 0;
}

.add-comment__txtarea {
    resize: none;
    border-radius: 20px;
}

.add-comment__txtarea:focus {
    outline: none;
}

.add-comment__btn {
    border:0;
    background-color: transparent;
}

.diary-modal-content__comments {
    height: inherit;
    position: relative;
    width: 30%;
}

.diary-comments {
    height: 540px;
    overflow-y: auto;
}

.diary-comment__txt {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
    overflow: hidden;
}


{% endblock %}

{% block modal %}
{% include '../__addon/diary_modal.html' %}
{% endblock %}


{% block contents %}
<div class="back mx-3 my-4">
    <a href="../profile" class="go-back">
        <svg width="50" height="50" fill="white">
            <use xlink:href="#go-back"></use>
        </svg>
    </a>
</div>

<div class="newsfeed-slider" data-slick='{"slidesToShow": 3, "slidesToScroll": 1}'>
    {% if data %}
    {% for diary in data %}
    <!-- a diary -->
    <div class="newsfeed-slider__item">

        <!-- 유저 정보 -->
        <div class="d-flex border-bottom p-2 align-items-center justify-content-between">
            <a href="../profile" class="diary-user d-flex align-items-center">
                <img src="{% static 'static/img/account/profile_on.webp' %}" class="diary-user__img" width="30" height="30"></img>
                <span class="diary-user__name mx-2"><strong>{{ diary.user.username }}</strong></span>
            </a>
            <div class="diary-user__detail d-flex">
                <svg width="20" height="20" fill="gray">
                    <use xlink:href="#three-dots"></use>
                </svg>
            </div>
        </div>
        <!-- 다이어리 내용 -->
        <div calss="diary-contents">
            <div class="diary-contents__date_emoji p-2 d-flex align-items-center justify-content-between">
                <span class="diary-contents__date">
                    {{diary.create_at}} 2023년 04월 12일 수요일
                </span>
                <div class="diary-contents__emoji d-flex align-items-center p-2" data-toggle="tooltip" title="기쁨 95%">
                    &#x1F601
                    <span class="mx-1">Happiness</span>
                </div>
            </div>
            <p class="diary-contents__title px-2">
                {{ diary.title }}
            </p>
            <p class="diary-contents__txt px-2">
                {{ diary.content }}
            </p>
            <p class="diary-contents__tag px-2">
                {% for tag in diary.tag %}
                #{{tag.name}}
                {% endfor %}
            </p>
            <p class="diary-contents__more px-2" id="to_detail">
                자세히 보기
            </p>
        </div>

        <!-- 다이어리 반응 -->
        <div class="diary-response p-2 border-top">
            <svg width="16" height="16" class="liked">
                <use xlink:href="#liked"></use>
            </svg>
            <span class="liked__count">{{ diary.num_like }}</span>
            <svg width="16" height="16" class="comments">
                <use xlink:href="#comments"></use>
            </svg>
            <span class="comments__count">{{ diary.num_comment }}</span>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>
{% endblock %}

{% block sc %}
    $( function() {
        $(".newsfeed-slider").slick({
            infinite: false,
            responsive: [{
                breakpoint: 1024,
                settings: {
                slidesToShow: 2,
                infinite: true
                }
            }, {
                breakpoint: 600,
                settings: {
                slidesToShow: 1,
                dots: true
                }
            }, {
                breakpoint: 300,
                settings: "unslick"
            }]
        });
    } );

    $(document).on("click","#to_detail", function(){
        const modals = document.querySelector('#modal_diary_detail');
        let modal = bootstrap.Modal.getOrCreateInstance(modals)  
        modal.show()
    })

    $(function() {
        $('textarea').on('keydown', function(event) {
            if (event.keyCode == 13)
                if (!event.shiftKey){
                    event.preventDefault();
                    $('#comment-form').submit();
                }
        });
    });

    $(document).on("click","#diary-comment__more", function(){
        $("#diary-comment__more").text("접기");
        const text = document.querySelector('.diary-comment__txt');
        text.style.display = 'block';
    })

{% endblock %}