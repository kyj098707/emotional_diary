{% extends "../base_layout.html" %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'static/css/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'static/css/personal_style.css' %}">


{% block right-up %}
우측상단
{% endblock %}

{% block right-down %}
<div id="follow-suggestion-list"></div>
{% endblock %}


{% block center %}
<div class="col-sm-8" id = middle-container style="background-color: white; height: 920px">
        <button type="button" class="btn btn-primary" id="diary_create" data-bs-toggle="modal" data-bs-target="#modal_diary_create">+ <span>diary</span></button>
        <div class="diary">
            <div class="diary_list_title">
            <a>asdastrtrtrtrtrt</a>
            <button class="delete-button" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                <path d="M10.07 8l3.965-3.965a.25.25 0 0 0 0-.354L13.32 3.07a.25.25 0 0 0-.354 0L8 6.93 4.035 3.965a.25.25 0 0 0-.354 0L2.68 4.32a.25.25 0 0 0 0 .354L6.93 8l-3.965 3.965a.25.25 0 0 0 0 .354l1.354 1.354a.25.25 0 0 0 .354 0L8 9.07l3.965 3.965a.25.25 0 0 0 .354 0l1.354-1.354a.25.25 0 0 0 0-.354L10.07 8z"/>
                </svg>
            </button>
            <button class="edit-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                <path d="M12.5 2a2.5 2.5 0 0 1 2.5 2.5c0 .646-.255 1.244-.67 1.68l-8.06 8.06a1.03 1.03 0 0 1-.697.315H2.5a1 1 0 0 1-1-1V9.527c0-.256.1-.512.293-.705l8.06-8.06A2.348 2.348 0 0 1 12.5 2zm-1.414 1.414a1.5 1.5 0 0 0-2.122 0l-.793.793L11.793 7l.793-.793a1.5 1.5 0 0 0 0-2.122l-.793-.793zm-1.414 1.414l-.793.793-4.586 4.586-1.586.402.402-1.586 4.586-4.586.793-.793a.5.5 0 0 1 .707 0l.586.586a.5.5 0 0 1 0 .707z"/>
                </svg>
            </button>
          </div>
            <div class="content">
                Today, I met up with some friends and we went to a new restaurant in town. The food was amazing and we had a great time catching up with each other. Later, I went to the gym and did a workout.
            </div>
          <div class="add">
            &hearts;<span class="heart__count">좋아요 n개</span>
            <i class="fas fa-envelope"><span>댓글 n개</span></i>
          </div>
            <div class="date"></div>
        </div>
      </div>
{% endblock %}

{% block sc %}
function request_ajax(url, method, data_dic, token) {
$.ajax({
url: url,
type: method,
beforeSend: function (xhr) {
xhr.setRequestHeader("Content-type", "application/json");
xhr.setRequestHeader("Authorization", "Bearer " + token);
},
async: false,
data: JSON.stringify(data_dic),
success: function (response) {
result = response
},
error: function (e) {
result = "error"
}
});
return result;
}

$( document ).ready( function() {
let suggest_ajax_url = "{% url 'account:api_user_suggestion' %}";
let token = localStorage.getItem("access")
response = request_ajax(suggest_ajax_url, "GET", {}, token)
if (response == "error") {
document.getElementById("error_msg").style.display = "block";
}
else {
const element = document.getElementById('follow-suggestion-list');
element.innerHTML = response;
}
let profile_ajax_url = "{% url 'account:api_my_profile_info' %}";
response = request_ajax(profile_ajax_url, "GET", {}, token)
console.log(response)
if (response == "error") {
document.getElementById("error_msg").style.display = "block";
}
else {
name_element = document.getElementById('right-profile-name');
follower_count = document.querySelector('.follower-count-value');
following_count = document.querySelector('.following-count-value');

name_element.innerText = response.username;
follower_count.innerHTML = '<span class="count follower-count-value" id="follower-'+response.id+'onclick="handleFollowerListClick(this.id)">'+response.num_follower+'</span>';
following_count.innerHTML = '<span class="count following-count-value" id="follower-'+response.id+'onclick="handleFollowingListClick(this.id)">'+response.num_following+'</span>';
}
<!--let diary_ajax_url = "{% url 'diary:diary-list' %}";-->

<!--       response = request_ajax(diary_ajax_url, "GET", {}, token)-->
<!--        const element = document.getElementById('content');-->
<!--        if (response == "error") {-->
<!--          document.getElementById("error_msg").style.display = "block";-->
<!--        }-->
<!--        else {-->
<!--          element.innerHTML = response;-->
<!--        }-->

});

const handleFollowClick = (buttonId) => {
id = buttonId.split("-").pop()
let token = localStorage.getItem("access")
let ajax_url = "http://127.0.0.1:8000/accounts/user/"+id+"/follow/"
data_dic = {}
result = request_ajax(ajax_url,"POST",data_dic,token)
follower_elem = document.getElementById('suggestion-follower-'+id);
follower_elem.innerText = `팔로우 ` + result.num_follower
follow_btn_elem = document.getElementById('follow-btn-'+id);
if(follow_btn_elem.innerText=="Follow")
{follow_btn_elem.innerText = `Following`}
else{follow_btn_elem.innerText = `Follow`}
}
const handleNameClick = (buttonId) => {
id = buttonId.split("-").pop()
console.log(buttonId)
console.log(id)

location.href = "http://127.0.0.1:8000/profile/"+id+"/"
};
{% endblock %}