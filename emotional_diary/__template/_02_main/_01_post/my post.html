{% extends "../../base_layout.html" %}
{% load static %}

{% block modal %}
  {% include "./diary_create.html" %}
{% include "../../__my_follow_modal.html" %}

{% endblock %}


{% block right-up %}
우측상단
{% endblock %}

{% block right-down %}
  <div id="follow-suggestion-list"></div>
{% endblock %}


{% block center %}
  <link rel="stylesheet" href="{% static 'static/css/personal_style.css' %}">

  <button type="button" class="btn btn-outline-dark diary_create_btn"  id="diary_create" data-bs-toggle="modal"
          data-bs-target="#modal_diary_create">+ diary</button>
  <div id="center-content"></div>

{% endblock %}




{% block sc %}

$(document).ready(function() {

    let suggest_ajax_url = "{% url 'account:api_user_suggestion' %}";
    let token = localStorage.getItem("access")
    response = request_ajax(suggest_ajax_url, "GET", {}, token)
    if (response == "error") {
        document.getElementById("error_msg").style.display = "block";
    } else {
        const element = document.getElementById('follow-suggestion-list');
        element.innerHTML = response;
    }
    let my_diary_ajax_url = "{% url 'diary:my-diary-list' %}";
    response = request_ajax(my_diary_ajax_url, "GET", {}, token)
    const element = document.getElementById('center-content');
    if (response == "error") {
        document.getElementById("error_msg").style.display = "block";
    } else {
        element.innerHTML = response;
    }
    let my_follow_list_ajax_url = "{% url 'account:api-my-followlist' %}";
    response = request_ajax(my_follow_list_ajax_url, "GET", {}, token)
    flw_element = document.getElementById('my-flwer-modal-content');
    console.log(response)
    flw_element.innerHTML = response
response

});

const handleFollowClick = (buttonId) => {
    id = buttonId.split("-").pop()
    let token = localStorage.getItem("access")
    let ajax_url = "http://127.0.0.1:8000/aivlary/user/" + id + "/follow/"
    data_dic = {}
    result = request_ajax(ajax_url, "POST", data_dic, token)
    follower_elem = document.getElementById('suggestion-follower-' + id);
    follower_elem.innerText = `팔로우 ` + result.num_follower
    follow_btn_elem = document.getElementById('follow-btn-' + id);
    if (follow_btn_elem.innerText == "Follow") {
        follow_btn_elem.innerText = `Following`
    } else {
        follow_btn_elem.innerText = `Follow`
    }
}
const handleNameClick = (buttonId) => {
    id = buttonId.split("-").pop()
    console.log(buttonId)
    console.log(id)

    location.href = "{% url 'diary:post' %}" + id + "/"
};


const handleDelClick = (buttonId) => {
    token = localStorage.getItem("access")
    id = buttonId.split("-").pop()
    let ajax_url = "{% url 'diary:diary-list' %}" + id
    data_dic = {
        "diary_id": id
    }
    response = request_ajax(ajax_url, "DELETE", data_dic, token)
    const element = document.getElementById("center-content");
    element.innerHTML = response
}

const handleLikeClick = (buttonId) => {
    token = localStorage.getItem("access")
    id = buttonId.split("-").pop()
    let ajax_url = "{% url 'diary:diary-list' %}" + id + "/like/"
    data_dic = {
        "diary_id": id
    }
    response = request_ajax(ajax_url, "POST", data_dic, token)
    console.log(response.num_like)
    const element = document.getElementById("num_like_" + id);
    console.log(element)
    element.innerHTML = `<div id=num_like>` + response.num_like + `개</div>`

}

{% endblock %}