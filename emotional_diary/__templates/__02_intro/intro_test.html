{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <link rel="stylesheet" href="{% static 'static/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'static/css/personal_style.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'static/css/bootstrap.min.css' %}">
  <script src="{% static 'static/jquery-3.6.3.min.js' %}"></script>
  <script src="{% static 'static/js/bootstrap.bundle.min.js' %}"></script>

  <style>
    body {
      background-image: url("{% static 'static/img/account/background.webp' %}");
    }

    .main_container {
      margin: 15px;
    }

    #left-container {
      border: 3px solid black;
      background-color: white;
      width: 20%;
      float: left;
      margin-left: 5px;
      margin-right: 10px;
      border-radius: 10px;
    }

    #middle-container {
      border: 3px solid black;
      background-color: white;
      width: 55%;
      float: left;
      margin-right: 10px;
      margin-left: 25px;
      border-radius: 10px;
    }

    #right-container {
      border: 3px solid black;
      background-color: white;
      width: 20%;
      float: left;
      margin-left: 25px;
      border-radius: 10px;
    }

    #diary_create {
      margin-top: 10px;
      font-weight: bold;
    }

    #diary_create span {
      margin-left: 40px;
    }

    .btn-primary {
      background-color: white;
      color: black;
      border: 2px solid black;
    }

    .btn-secondary {
      background-color: white;
      color: black;
      border: 2px solid black;
    }

    .diary {
      margin-top: 30px;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }

    .title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .edit-button {
      border: none;
      background: none;
      float: right;
    }

    .delete-button {
      background: none;
      border: none;
      color: black;
      float: right;
    }



    .diary .content {
      margin-top: 20px;
      font-size: 18px;
      line-height: 1.5;
    }

    .diary .date {
      font-size: 14px;
      color: gray;
      margin-top: 10px;
      text-align: right;
      margin-right: 10px;
    }

    .add {
      margin-top: 20px;
      display: inline-block;
      color: red;
      font-size: 18px;
      cursor: pointer;
    }

    .heart__count {
      display: inline-block;
      font-weight: 500;
      color: black;
      font-size: 18px;
      margin-left: 5px;
      vertical-align: middle;
    }

    .fa-envelope {
      display: inline-block;
      font-weight: 600;
      color: black;
      font-size: 18px;
      margin-left: 20px;
      vertical-align: middle;
    }

    .fa-envelope span {
      margin-left: 10px;
      font-weight: 500;
    }

    .comment {
      font-size: 14px;
      color: #666;
      margin-left: 10px;
    }




    .User {
      display: flex;
      justify-content: center;
      font-size: 40px;

    }



    .icon {
      display: flex;
      justify-content: center;
      margin-top: 50px;
      margin-bottom: 20px;
    }

    .icon i {
      margin: 0 30px;
      border: none;
      background-color: black;
      color: white;
      padding: 10px;
      font-size: 32px;
      border-radius: 50%;
      cursor: none;
      transition: all 0.2s ease-in-out;
    }

    .icon i:hover {
      transform: scale(1.1);
      cursor: pointer;
    }

    .icon i:active {
      cursor: none;
    }
  </style>
</head>

<body>
  <!--<div class="bg-img-container">
  <div class="bg-img"></div>

</div> -->

  <div class="bg-img-container">
    <div class="bg-img"></div>
  </div>
  <div class="main_container">
    <div class="row">
      <div class="col-sm-2" id=left-container style="background-color: white; height: 920px;"></div>
      <div class="col-sm-8" id=middle-container style="background-color: white; height: 920px">
        <script type="text/javascript">
          const handleLikeClick = (buttonId) => {
            token = localStorage.getItem("access")
            id = buttonId.split("-").pop()
            let ajax_url = "{% url 'diary:diary-list' %}" + id + "/like/"
            data_dic = { "diary_id": id }
            response = request_ajax(ajax_url, "POST", data_dic, token)
            console.log(response.num_like)
            const element = document.getElementById("num_like_" + id);
            console.log(element)
            element.innerHTML = `<div id=num_like>` + response.num_like + `개</div>`

          }

        </script>
        <div id='content'></div>
      </div>

      <div class="col-sm-2" id=right-container style="background-color: white; height: 920px;"></div>
    </div>


    <div class="modal fade" id="modal_diary_create" tabindex="-1" aria-labelledby="modal_diary_create_label"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal_diary_create_label">Create New Diary</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form class="d-grid gap-2">
              <div class="mb-3">
                <label for="diary_title" class="form-label">Title:</label>
                <input type="text" class="form-control" id="diary_title">
              </div>
              <div class="mb-3">
                <label for="diary_contents" class="form-label">Contents:</label>
                <textarea class="form-control" id="diary_contents" rows="6"></textarea>
              </div>
              <div class="text-end">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Submit</button>
              </div>


            </form>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      function request_ajax(url, method, data_dic, token) {
        $.ajax({
          url: url,
          type: method,
          beforeSend: function (xhr) {
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.setRequestHeader("Authorization", "Bearer " + token);
          },
          async: false,
          data: data_dic,
          success: function (response) {
            result = response
          },
          error: function (e) {
            result = "error"
          }
        });
        return result;
      }
      $(document).ready(function () {

        let ajax_url = "{% url 'diary:diary-list' %}";

        let token = localStorage.getItem("access")
        response = request_ajax(ajax_url, "GET", {}, token)
        const element = document.getElementById('content');
        if (response == "error") {
          element.innerHTML = "<div style='color:red'>로그인 하셔야합니당</div>";
        }
        else {
          var elem = ""
          for (var i = 0; i < response.length; i++) {
            elem = elem +
              '<div class="diary id="> \
					<div class="title">' +
              response[i].title +
              '<button class="delete-button"> \
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16"> \
                <path d="M10.07 8l3.965-3.965a.25.25 0 0 0 0-.354L13.32 3.07a.25.25 0 0 0-.354 0L8 6.93 4.035 3.965a.25.25 0 0 0-.354 0L2.68 4.32a.25.25 0 0 0 0 .354L6.93 8l-3.965 3.965a.25.25 0 0 0 0 .354l1.354 1.354a.25.25 0 0 0 .354 0L8 9.07l3.965 3.965a.25.25 0 0 0 .354 0l1.354-1.354a.25.25 0 0 0 0-.354L10.07 8z"/> \
              </svg> \
            </button> \
            <button class="edit-button"> \
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16"> \
                <path d="M12.5 2a2.5 2.5 0 0 1 2.5 2.5c0 .646-.255 1.244-.67 1.68l-8.06 8.06a1.03 1.03 0 0 1-.697.315H2.5a1 1 0 0 1-1-1V9.527c0-.256.1-.512.293-.705l8.06-8.06A2.348 2.348 0 0 1 12.5 2zm-1.414 1.414a1.5 1.5 0 0 0-2.122 0l-.793.793L11.793 7l.793-.793a1.5 1.5 0 0 0 0-2.122l-.793-.793zm-1.414 1.414l-.793.793-4.586 4.586-1.586.402.402-1.586 4.586-4.586.793-.793a.5.5 0 0 1 .707 0l.586.586a.5.5 0 0 1 0 .707z"/> \
              </svg> \
            </button> \
          </div> \
					<div class="content">' +
              response[i].content +
              '</div> \
          <div class="add"> \
            &hearts;<span class="heart__count" onclick="handleLikeClick(this.id)" id=like-'+ response[i].id + '> 좋아요 <div id=num_like_' + response[i].id + '>' + response[i].num_like + '개</div></span> \
            <i class="fas fa-envelope"><span>댓글' + response[i].num_comment + '</span></i> \
          </div> \
					<div class="date">April 12, 2023</div> \
				</div>'
          }

          element.innerHTML = elem;

        }



        const modal = new bootstrap.Modal(document.getElementById('modal_diary_create'));
        $("#diary_create").click(function () {
          modal.show();
        });




        $("#modal_diary_create form").submit(function (event) {
          event.preventDefault();

          const title = $("#diary_title").val();
          const contents = $("#diary_contents").val();


          modal.hide();
        });

        $("#modal_diary_create button[data-bs-dismiss='modal']").click(function () {
          modal.hide();
        });
      });






    </script>


</body>

</html>